效果在另外一贴已经发出

http://www.newsmth.net/nForum/#!article/DigiHome/577060

在此写个简单的攻略吧，仅适用于EPON的，GPON的我没有研究。VLAN ID的具体数值应该也只适用于北京联通，别的地方的可能需要自己去旧猫上查。

我这个情况比较特殊，除了上网，还有座机和IPTV，其中座机如果是SIP的话是最难搞的，如果没有座机的需求的话，至少省力80%.

首先，光猫分EPON和GPON的，如果换的话，一定要买和原先光猫的PON类型相同的。千兆是必须的，至少LAN1得是千兆的。8240比较经典，有4口千兆的，但也有全百兆口的缩水版。8245好像LAN1千兆的和四口千兆的都有，貌似后者叫8245H。还有个8245C2，可以软改8245H，Chinadsl上有攻略。将买来的光猫用超五类或以上的线直连有千兆网卡的电脑，看一下连接速率，1G的话就是千兆口。猫也分华为界面的和运营商定制的，定制的也可以刷成华为界面(攻略：http://www.chinadsl.net/forum.php?mod=viewthread&tid=123557&extra=page%3D2)。EPON的猫联通是靠MAC地址来识别的，MAC地址是可以改的，所以换猫上网是不需要找联通师傅来帮忙注册新猫MAC的，把新猫MAC改成旧猫的就可以了。GPON的我没改过，貌似也不难。


1.上网和IPTV

如果只是为了享受200M带宽（实测250）上网的话，那最简单的就是买个二手8240千兆版，非运营商定制的，插上后将IP设置到192.168.100.x，网关192.168.100.1。首先telnet到192.168.100.1，用户名root，密码admin。然后执行set lanmac mac xx:xx:xx:xx:xx:xx，这里的MAC地址为旧猫的MAC地址，一般贴在猫的背面。如果想改得全一点的话，也可以参考soff大神的贴

http://www.newsmth.net/nForum/#!article/DigiHome/575807?p=2

然后登陆Web管理页面192.168.100.1，用户名telecomadmin，密码admintelecom，先到LAN设置那里把LAN1到LAN4都打开。然后到WAN设置那里，加一个桥接的Internet，使能都勾上，VLAN ID是3961，优先级0，组播ID4000，绑定LAN1或者多个LAN口。插上光纤，PON灯一亮基本OK。网线最好插LAN1上，然后用电脑拨号，到www.speedtest.net上测速。200兆带宽的实测240多到250左右。

IPTV也不难，我的VLAN ID 是3964，绑定LAN4，选择路由模式，在IPTV盒子那里我连的是网线，设置成了自动获取IP，应该也可以用无线。

改完设置点应用按钮后，只是当时生效，都改好了之后需要在系统工具的配置文件选项那里，点一下保存配置文件才行，否则重启猫后会丢失所做的修改。


2.关于使能工具

凡是无法用telnet连上的猫，一个是IP段不对（一般是192.168.100或者192.168.1，IP段不对时会显示无法识别的网络），或者就是telnet端口被封了。这时需要用到使能工具打开。我是从deader网友那里取得，chinadsl上也有

http://www.chinadsl.net/forum.php?mod=viewthread&tid=123596&highlight=%CA%B9%C4%DC

这个好像便宜些：

http://www.chinadsl.net/forum.php?mod=viewthread&tid=126243&extra=&highlight=%CA%B9%C4%DC&page=1

总之使能工具要用最新版的，貌似是2015年的，不要用那个2013年的。

我在win7正常模式下一直使用不成功，可能是防火墙的原因，后来发现进入带网络的安全模式下（开机按F8可选择），就很容易成功。使能成功时，猫所有灯全亮，此时就可以点停止，然后重启猫，一般就可以telenet上去了。


3.电话

这个是最难的，首先，要从原猫中获取局端下发的配置。需要用到使能工具。

语音协议分两种，H.248和SIP.

其中H.248的还好，只需把从旧猫抄过来的ip设置填好就可以了。可是SIP的不仅需要IP，还需要鉴权密码。8346R在本地存储鉴权密码都是以加密形式存储的（这里不同于配置文件hw_ctree.xml的加密，而是另外的单独加密）。即使用解密工具解了hw_ctree.xml，鉴权密码还是显示为以$1或者$2开头，以$结尾的一段密文。旧猫WEB上显示为点号，即使用了密码查看器，看到的也是这段$开头加密后的文本。破译鉴权密码的方法在chinadsl按关键字一找就能看到，找不到的话私信问我也行。(要破译的趁早哈，chinadsl的大神目前应该是每天在线，也期待水木能出现破译的高手）

另外附上8346R破解方法，http://www.chinadsl.net/forum.php?mod=viewthread&tid=123349&extra=&highlight=8346r&page=1

破解后在WEB界面就可以愉快的抄老猫的配置了。其实在WEB管理界面的这些设置值，在hw_ctree.xml里面都有，不用把8346R刷成华为界面也行，从hw_ctree.xml里面找就是了，但是很不直观，有的对应关系要靠猜。要方便就转成华为界面吧，各个参数一目了然。8346R的固件一般是双协议都支持的。如果语音界面要提供用户名和密码，那就是SIP协议的。如果是上面要输入MGC服务器地址的，那就是H.248的。从WEB管理界面也可以导入导出配置文件，我从8346r上导出的文件在8245上导入后发现没有效果，应该是版本差别太大导致的不兼容。只好手抄各种配置。有的配置似乎在hw_ctree.xml中的定义比界面上能输入的东西更多。比如数图，在hw_ctree.xml中是定义了三组，而WEB界面中只能输入一组，这种情况我是先将新猫配置文件导出，然后把老猫的这一小块对应的xml替换到新猫导出的xml上，然后再从web导入进去。

无论哪种协议，在WAN那里也要为电话新建一项，VLAN ID我这里是3010，用静态IP，照抄老猫的就行。


4.关于固件

如果你买的新千兆猫的语音协议是H.248的，但是老猫8346R是SIP的（或者反过来），那就要把新买的猫刷固件刷成和老猫一致的了(不用座机的请无视）。一般固件上有C00的是SIP的，C01是H.248的，C10是双协议都支持的。

